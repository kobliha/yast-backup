// Backup module - testsuite
//
// ExcludeNodevFS function test
//
// $Id$
//

{

include "testsuite.ycp";

map readmap = $[ "target" : $["string" : "", "size" : -1, "tmpdir" : "/tmp" ],
    "proc" : $["cpuinfo" : $[ "value" : $["0" : $[ "flags" : ""]]]],
    "probe" : $["has_smp" : false, "cdrom" : $["manual" : []]],
    "sysconfig" : $[ "autoinstall" : $[
      "REPOSITORY" : "/var/lib/autoinstall/repository",
      "ALICE_REPOSITORY" : "/var/lib/autoinstall/repository",
      "CLASS_DIR" : "/var/lib/autoinstall/repository/classes",
      "XSLT_DONTMERGE" : "addon,conf"
    ]]
    ];

map execmap = $[ "target" : $["bash_output" : $["exit":0, "stderr":"", "stdout":"charmap=\"ISO-8859-1\"\n"]]];

TESTSUITE_INIT([ readmap, $[], execmap ], nil);

import "Pkg";   // override packamanager

import "Backup";

readmap = $[];
TEST( ``(Backup::ExcludeNodevFS()), [ readmap, $[], execmap ], nil );
DUMP(Backup::fs_exclude);

readmap = $[ "proc" : $[ "filesystems" : $["afs":"nodev", "iso9660":"\t", "minix":"\t", "nfs":"nodev", "pipefs":"nodev", "proc":"nodev", "ramfs":"nodev", "reiserfs":"\t", "rootfs":"nodev"]]];
TEST( ``(Backup::ExcludeNodevFS()), [ readmap, $[], execmap ], nil );
DUMP(Backup::fs_exclude);

readmap = $[];
Backup::fs_exclude = [];
TEST( ``(Backup::ExcludeNodevFS()), [ readmap, $[], execmap ], nil );
DUMP(Backup::fs_exclude);

}

